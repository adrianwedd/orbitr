(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8728:function(e,t,a){Promise.resolve().then(a.bind(a,6126))},6126:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return et}});var s=a(7437),n=a(2265),r=a(3464),i=a(9625);let c=e=>e*Math.PI/180,l=()=>Math.random().toString(36).slice(2,9),o=(e,t,a,s)=>({id:e,name:t,radius:a,color:s,volume:.8,muted:!1,solo:!1,steps:Array.from({length:16},(e,a)=>({id:l(),active:!1,gain:.9,prob:1,prompt:"",buffer:null,name:"".concat(t," ").concat(a+1)}))}),d=(0,i.Ue)((e,t)=>({tracks:[o("track1","O",180,"#ef4444"),o("track2","R",150,"#3b82f6"),o("track3","B",120,"#10b981"),o("track4","I",90,"#f59e0b")],selectedTrack:"track1",selectedStep:null,library:[],genQueue:[],audioCache:new Map,get sampleLibrary(){return this.library},get generationQueue(){return this.genQueue},currentStep:0,isPlaying:!1,bpm:120,swing:0,masterGain:.8,isLoading:!1,loadingMessage:"",errorMessage:null,updateStepMulti:(t,a,s)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,steps:e.steps.map((e,t)=>t===a?{...e,...s}:e)}:e)})),toggleStepMulti:(t,a)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,steps:e.steps.map((e,t)=>t===a?{...e,active:!e.active}:e)}:e)})),clearStepMulti:(t,a)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,steps:e.steps.map((t,s)=>s===a?{...t,active:!1,buffer:null,name:"".concat(e.name," ").concat(s+1)}:t)}:e)})),setTrackVolume:(t,a)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,volume:a}:e)})),setTrackMute:(t,a)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,muted:a}:e)})),setTrackSolo:(t,a)=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,solo:a}:{...e,solo:!1})})),clearTrack:t=>e(e=>({tracks:e.tracks.map(e=>e.id===t?{...e,steps:e.steps.map((t,a)=>({...t,active:!1,buffer:null,name:"".concat(e.name," ").concat(a+1)}))}:e)})),setSelectedTrack:t=>e({selectedTrack:t}),setSelectedStep:t=>e({selectedStep:t}),addToLibrary:t=>e(e=>({library:[t,...e.library]})),assignToStepMulti:(t,a,s)=>e(e=>{let n=e.library.find(e=>e.id===s);return n?{tracks:e.tracks.map(e=>e.id===t?{...e,steps:e.steps.map((e,t)=>t===a?{...e,active:!0,buffer:n.buffer,name:n.name,prompt:n.prompt||e.prompt}:e)}:e)}:e}),addToQueue:t=>e(e=>({genQueue:[...e.genQueue,t]})),updateQueueItem:(t,a)=>e(e=>({genQueue:e.genQueue.map(e=>e.id===t?{...e,...a}:e)})),removeFromQueue:t=>e(e=>({genQueue:e.genQueue.filter(e=>e.id!==t)})),clearQueue:()=>e({genQueue:[]}),addToSampleLibrary:t=>e(e=>({library:[t,...e.library]})),removeFromSampleLibrary:t=>e(e=>({library:e.library.filter(e=>e.id!==t)})),clearLibrary:()=>e({library:[]}),setCurrentStep:t=>e({currentStep:t}),setBpm:t=>e({bpm:t}),setSwing:t=>e({swing:t}),togglePlayback:()=>e(e=>({isPlaying:!e.isPlaying})),setPlaying:t=>e({isPlaying:t}),setIsPlaying:t=>e({isPlaying:t}),setMasterGain:t=>e({masterGain:t}),clearSampleLibrary:()=>e({library:[]}),addToGenerationQueue:t=>e(e=>({genQueue:[...e.genQueue,t]})),removeFromGenerationQueue:t=>e(e=>({genQueue:e.genQueue.filter(e=>e.id!==t)})),updateGenerationProgress:(t,a,s)=>e(e=>({genQueue:e.genQueue.map(e=>e.id===t?{...e,progress:a,status:s}:e)})),get track(){var a;let e=t(),s=e.selectedTrack;if(s){let t=e.tracks.find(e=>e.id===s);return(null==t?void 0:t.steps)||[]}return(null===(a=e.tracks[0])||void 0===a?void 0:a.steps)||[]},updateStep:(e,a)=>{var s;let n=t(),r=n.selectedTrack||(null===(s=n.tracks[0])||void 0===s?void 0:s.id);r&&n.updateStepMulti(r,e,a)},toggleStep:e=>{var a;let s=t(),n=s.selectedTrack||(null===(a=s.tracks[0])||void 0===a?void 0:a.id);n&&s.toggleStepMulti(n,e)},assignToStep:(e,a)=>{var s;let n=t(),r=n.selectedTrack||(null===(s=n.tracks[0])||void 0===s?void 0:s.id);r&&n.assignToStepMulti(r,e,a)},clearStep:e=>{var a;let s=t(),n=s.selectedTrack||(null===(a=s.tracks[0])||void 0===a?void 0:a.id);n&&s.clearStepMulti(n,e)},setLoading:function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e({isLoading:t,loadingMessage:a})},setError:t=>e({errorMessage:t,isLoading:!1}),clearError:()=>e({errorMessage:null}),getTrack:()=>{var e;let a=t(),s=a.selectedTrack;if(s){let e=a.tracks.find(e=>e.id===s);return(null==e?void 0:e.steps)||[]}return(null===(e=a.tracks[0])||void 0===e?void 0:e.steps)||[]}}));var u=a(995);function m(e){let{content:t,children:a,side:n="top",align:r="center",delayDuration:i=200,disabled:c=!1}=e;return c?(0,s.jsx)(s.Fragment,{children:a}):(0,s.jsx)(u.zt,{delayDuration:i,skipDelayDuration:300,children:(0,s.jsxs)(u.fC,{children:[(0,s.jsx)(u.xz,{asChild:!0,children:a}),(0,s.jsx)(u.h_,{children:(0,s.jsxs)(u.VY,{side:n,align:r,className:"z-50 max-w-xs rounded-lg bg-zinc-800 px-3 py-2 text-sm text-zinc-100 shadow-lg border border-zinc-700 animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",sideOffset:5,children:[t,(0,s.jsx)(u.Eh,{className:"fill-zinc-800"})]})})]})})}function h(e){let{shortcut:t,description:a,children:n,side:r="top",disabled:i=!1}=e,c=(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-medium",children:a}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-zinc-400",children:["Press ",(0,s.jsx)("kbd",{className:"px-1.5 py-0.5 bg-zinc-700 rounded text-zinc-200 font-mono",children:t})]})]});return(0,s.jsx)(m,{content:c,side:r,disabled:i,children:n})}var p=a(277);function g(e){let{open:t,onOpenChange:a,title:n,description:r,confirmText:i="Confirm",cancelText:c="Cancel",variant:l="default",onConfirm:o,children:d}=e;return(0,s.jsxs)(p.fC,{open:t,onOpenChange:a,children:[d&&(0,s.jsx)(p.xz,{asChild:!0,children:d}),(0,s.jsxs)(p.h_,{children:[(0,s.jsx)(p.aV,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 animate-in fade-in-0"}),(0,s.jsxs)(p.VY,{className:"fixed left-1/2 top-1/2 z-50 w-full max-w-md -translate-x-1/2 -translate-y-1/2 rounded-lg bg-zinc-900 border border-zinc-700 p-6 shadow-xl animate-in fade-in-0 zoom-in-95 slide-in-from-left-1/2 slide-in-from-top-[48%]",children:[(0,s.jsx)(p.Dx,{className:"text-lg font-semibold text-zinc-100 mb-2",children:n}),(0,s.jsx)(p.dk,{className:"text-sm text-zinc-400 mb-6",children:r}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)(p.$j,{asChild:!0,children:(0,s.jsx)("button",{className:"px-4 py-2 text-sm bg-zinc-700 text-zinc-300 rounded-lg hover:bg-zinc-600 transition-colors",children:c})}),(0,s.jsx)(p.aU,{asChild:!0,children:(0,s.jsx)("button",{onClick:()=>{o(),a(!1)},className:"px-4 py-2 text-sm rounded-lg transition-colors ".concat("destructive"===l?"bg-red-600 text-white hover:bg-red-700":"bg-emerald-600 text-white hover:bg-emerald-700"),children:i})})]})]})]})]})}let x={PLAY_STOP:"Space",GENERATE:"G",CLEAR:"C",REVERSE:"R",BPM_INCREASE:"ArrowRight",BPM_DECREASE:"ArrowLeft"},f=["1","2","3","4","5","6","7","8","9","0","Q","W","E","R","T","Y"];function b(e){switch(e){case"play_stop":return"Play/Stop sequencer";case"generate":return"Generate AI sample for selected step";case"clear":return"Clear selected step";case"reverse":return"Toggle reverse playback";case"bpm_adjust":return"Adjust BPM";case"step_select":return"Select step";default:return""}}function y(e){let{steps:t,onStepChange:a,onAssign:r,onGenerate:i,onClear:c,library:l}=e,[o,d]=(0,n.useState)(0),[u,p]=(0,n.useState)(null),[f,y]=(0,n.useState)(!1),k=t[o],v=async()=>{if(k.prompt){p(o);try{await i(k.prompt,o,{quality:"draft"})}finally{p(null)}}},w=async()=>{if(k.prompt){p(o);try{await i(k.prompt,o,{quality:"high"})}finally{p(null)}}};return(0,s.jsxs)("div",{className:"bg-zinc-900 text-zinc-100 rounded-2xl p-5 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"Step Editor"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m,{content:"Select step to edit (use 1-9, 0, Q-Y keys)",side:"top",children:(0,s.jsx)("label",{className:"text-sm text-zinc-400 cursor-help",children:"Step"})}),(0,s.jsx)("select",{className:"bg-zinc-800 rounded-lg px-3 py-1.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-400",value:o,onChange:e=>d(parseInt(e.target.value,10)),"aria-label":"Select step to edit",children:t.map((e,t)=>(0,s.jsxs)("option",{value:t,children:["Step ",t+1]},t))})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{content:"Assign a sample from the library to this step",side:"top",children:(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-zinc-500 mb-1 block cursor-help",children:"Assigned Sample"})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("select",{className:"bg-zinc-800 rounded-lg px-3 py-2 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-400",value:"",onChange:e=>r(o,e.target.value),"aria-label":"Assign sample to step ".concat(o+1),children:[(0,s.jsx)("option",{value:"",disabled:!0,children:k.buffer?k.name:"— Choose from library —"}),l.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ","ai"===e.type&&"✨"]},e.id))]}),(0,s.jsx)(m,{content:"".concat(k.active?"Deactivate":"Activate"," this step"),side:"top",children:(0,s.jsx)("button",{className:"px-3 py-2 rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-zinc-900 ".concat(k.active?"bg-emerald-600 hover:bg-emerald-700 text-white focus:ring-emerald-400":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300 focus:ring-blue-400"),onClick:()=>a(o,{active:!k.active}),"aria-label":"".concat(k.active?"Deactivate":"Activate"," step ").concat(o+1),"aria-pressed":k.active,children:k.active?"ON":"OFF"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{content:"Volume level for this step (0-100%)",side:"top",children:(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-zinc-500 mb-1 block cursor-help",children:"Gain"})}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:k.gain,onChange:e=>a(o,{gain:parseFloat(e.target.value)}),className:"w-full focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Step ".concat(o+1," gain: ").concat((100*k.gain).toFixed(0),"%")}),(0,s.jsx)("div",{className:"text-right text-xs text-zinc-400 mt-1",children:k.gain.toFixed(2)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{content:"Chance this step will trigger (0-100%)",side:"top",children:(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-zinc-500 mb-1 block cursor-help",children:"Probability"})}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:k.prob,onChange:e=>a(o,{prob:parseFloat(e.target.value)}),className:"w-full focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Step ".concat(o+1," probability: ").concat((100*k.prob).toFixed(0),"%")}),(0,s.jsxs)("div",{className:"text-right text-xs text-zinc-400 mt-1",children:[(100*k.prob).toFixed(0),"%"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{content:"Describe the sound you want AI to generate",side:"top",children:(0,s.jsx)("label",{className:"text-xs uppercase tracking-wide text-zinc-500 mb-1 block cursor-help",children:"AI Prompt"})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"text",className:"bg-zinc-800 rounded-lg px-3 py-2 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"e.g., lofi kick drum with vinyl warmth",value:k.prompt,onChange:e=>a(o,{prompt:e.target.value}),"aria-label":"AI prompt for step ".concat(o+1)}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(h,{shortcut:x.GENERATE,description:b("generate"),side:"top",children:(0,s.jsx)("button",{className:"px-3 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-all focus:outline-none focus:ring-2 focus:ring-purple-400",onClick:v,disabled:!k.prompt||null!==u,"aria-label":"Generate draft quality sample",children:u===o?"...":"Draft"})}),(0,s.jsx)(m,{content:"Generate high quality sample (slower)",side:"top",children:(0,s.jsx)("button",{className:"px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-all focus:outline-none focus:ring-2 focus:ring-indigo-400",onClick:w,disabled:!k.prompt||null!==u,"aria-label":"Generate high quality sample",children:"HQ"})})]})]}),(0,s.jsx)("p",{className:"text-xs text-zinc-500 mt-2",children:"Draft: Fast generation (small model) • HQ: High quality (melody model)"}),k.buffer&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(h,{shortcut:x.CLEAR,description:b("clear"),side:"top",children:(0,s.jsx)("button",{onClick:()=>y(!0),className:"w-full px-3 py-2 text-sm bg-zinc-700 text-zinc-300 rounded-lg hover:bg-red-600 hover:text-white transition-all focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":"Clear sample from step ".concat(o+1),children:"Clear Step Sample"})})})]}),(0,s.jsxs)("details",{className:"group",children:[(0,s.jsx)(m,{content:"Advanced playback conditions for this step",side:"top",children:(0,s.jsx)("summary",{className:"text-xs uppercase tracking-wide text-zinc-500 cursor-pointer hover:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded",children:"Advanced Options ▸"})}),(0,s.jsx)("div",{className:"mt-3 space-y-3",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(m,{content:"When this step should trigger during playback",side:"top",children:(0,s.jsx)("label",{className:"text-xs text-zinc-500 cursor-help",children:"Step Condition"})}),(0,s.jsxs)("select",{className:"bg-zinc-800 rounded-lg px-3 py-2 text-sm w-full mt-1 focus:outline-none focus:ring-2 focus:ring-blue-400",value:k.condition||"always",onChange:e=>a(o,{condition:e.target.value}),"aria-label":"Step ".concat(o+1," trigger condition"),children:[(0,s.jsx)("option",{value:"always",children:"Always"}),(0,s.jsx)("option",{value:"fill",children:"Fill (last bar)"}),(0,s.jsx)("option",{value:"not_fill",children:"Not Fill"}),(0,s.jsx)("option",{value:"50%",children:"50% Chance"}),(0,s.jsx)("option",{value:"75%",children:"75% Chance"})]})]})})]})]}),(0,s.jsx)(g,{open:f,onOpenChange:y,title:"Clear Step Sample",description:"Are you sure you want to clear the sample from step ".concat(o+1,"? This will remove the assigned sample but keep the step settings."),confirmText:"Clear Sample",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{c(o)}})]})}var k=a(257);let v={apiUrl:"http://localhost:8000",isStaticMode:!1,maxAudioFileSize:parseInt(k.env.NEXT_PUBLIC_MAX_AUDIO_FILE_SIZE||"52428800"),audioCacheSize:parseInt(k.env.NEXT_PUBLIC_AUDIO_CACHE_SIZE||"100"),debugAudio:"true"===k.env.NEXT_PUBLIC_DEBUG_AUDIO,debugGeneration:"true"===k.env.NEXT_PUBLIC_DEBUG_GENERATION,audioLookAhead:25,audioScheduleAhead:.1,maxPreviewDuration:1e4};function w(){let e=v.apiUrl;try{return new URL(e),e}catch(t){return console.warn("Invalid API URL: ".concat(e,", falling back to localhost")),"http://localhost:8000"}}function j(e){let{library:t,onFileUpload:a}=e,{isLoading:i,loadingMessage:c,errorMessage:l,setLoading:o,setError:u,clearError:h}=d(),[p,x]=(0,n.useState)([]),[f,b]=(0,n.useState)(!1),[y,k]=(0,n.useState)(!1),{cacheInfo:j,isLoading:N,error:C,clearCache:T,formatBytes:z,getCacheUsagePercentage:A,isCacheNearLimit:S,isCacheOverLimit:M}=function(){let[e,t]=(0,n.useState)({size:0,files:0,maxSize:104857600}),[a,s]=(0,n.useState)(!1),[i,c]=(0,n.useState)(null),l=(0,n.useCallback)(async()=>{try{c(null);let e=w(),a=await r.Z.get("".concat(e,"/cache/size"));t(e=>({...e,size:a.data.size_bytes||0,files:a.data.file_count||0}))}catch(e){c("Failed to fetch cache information"),console.error("Cache info fetch error:",e)}},[]),o=(0,n.useCallback)(async()=>{try{s(!0),c(null);let e=w();return await r.Z.post("".concat(e,"/cache/clear")),t(e=>({...e,size:0,files:0})),!0}catch(e){return c("Failed to clear cache"),console.error("Cache clear error:",e),!1}finally{s(!1)}},[]),d=(0,n.useCallback)(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},[]),u=(0,n.useCallback)(()=>e.size/e.maxSize*100,[e.size,e.maxSize]),m=(0,n.useCallback)(()=>u()>80,[u]),h=(0,n.useCallback)(()=>e.size>e.maxSize,[e.size,e.maxSize]);return(0,n.useEffect)(()=>{l();let e=setInterval(l,3e4);return()=>clearInterval(e)},[l]),{cacheInfo:e,isLoading:a,error:i,fetchCacheInfo:l,clearCache:o,formatBytes:d,getCacheUsagePercentage:u,isCacheNearLimit:m,isCacheOverLimit:h}}(),R=(0,n.useCallback)(e=>e.size>v.maxAudioFileSize?"File size exceeds ".concat(Math.round(v.maxAudioFileSize/1024/1024),"MB limit"):["audio/wav","audio/mp3","audio/mpeg","audio/ogg","audio/webm","audio/aac"].includes(e.type)||e.name.match(/\.(wav|mp3|ogg|webm|aac)$/i)?null:"Invalid audio format. Supported: WAV, MP3, OGG, WebM, AAC",[]),I=(0,n.useCallback)(async e=>{x([]),h();let t=[],s=[];for(let a of e){let e=R(a);e?t.push({file:a.name,error:e}):s.push(a)}if(t.length>0&&x(t),s.length>0)try{o(!0,"Processing ".concat(s.length," file").concat(s.length>1?"s":"","...")),await a(s)}catch(e){u("Upload failed: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{o(!1)}},[R,a,o,u,h]),E=(0,n.useCallback)(e=>{e.preventDefault(),b(!1),I(Array.from(e.dataTransfer.files))},[I]),P=(0,n.useCallback)(e=>{e.preventDefault(),b(!0)},[]),D=(0,n.useCallback)(e=>{e.preventDefault(),b(!1)},[]),F=(0,n.useCallback)(async e=>{try{let t=new(window.AudioContext||window.webkitAudioContext);"suspended"===t.state&&await t.resume();let a=t.createBufferSource();a.buffer=e.buffer,a.connect(t.destination),a.start();let s=()=>{try{a.disconnect(),t.close()}catch(e){}};a.onended=s,setTimeout(s,v.maxPreviewDuration),function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];v.debugAudio&&console.log("[AUDIO DEBUG] ".concat(e),...a)}("Playing preview",{name:e.name,duration:e.duration})}catch(e){u("Preview failed: ".concat(e instanceof Error?e.message:"Unknown error"))}},[u]),B=async()=>{await T()&&setTimeout(()=>{},100)};return(0,s.jsxs)("div",{className:"bg-zinc-900 text-zinc-100 rounded-2xl p-5 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"Sample Library"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-sm text-zinc-400",children:[t.length," samples"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m,{content:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-medium",children:"AI Sample Cache"}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400 mt-1",children:[z(j.size)," / ",z(j.maxSize)]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400",children:[j.files," cached files"]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400 mt-1",children:[A().toFixed(1),"% used"]})]}),side:"top",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,s.jsx)("div",{className:"w-16 h-2 bg-zinc-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all ".concat(M()?"bg-red-500":S()?"bg-yellow-500":"bg-emerald-500"),style:{width:"".concat(Math.min(100,A()),"%")}})}),(0,s.jsxs)("span",{className:"text-xs ".concat(M()?"text-red-400":S()?"text-yellow-400":"text-zinc-400"),children:[A().toFixed(0),"%"]})]})}),(0,s.jsx)(m,{content:"Clear AI sample cache",side:"top",children:(0,s.jsx)("button",{onClick:()=>k(!0),disabled:N||0===j.size,className:"text-xs px-2 py-1 bg-zinc-700 text-zinc-300 rounded hover:bg-red-600 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-red-400","aria-label":"Clear cache",children:"Clear"})})]})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-24 border-2 border-dashed rounded-lg transition-colors cursor-pointer ".concat(f?"border-emerald-500 bg-emerald-500/10":i?"border-purple-500 bg-purple-500/10":"border-zinc-700 hover:border-emerald-600"),onDrop:E,onDragOver:P,onDragLeave:D,children:(0,s.jsx)("div",{className:"text-center",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm text-purple-400",children:c})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-zinc-400",children:"Drop audio files here"}),(0,s.jsx)("p",{className:"text-xs text-zinc-500 mt-1",children:"or click to browse"}),(0,s.jsxs)("p",{className:"text-xs text-zinc-600 mt-1",children:["WAV, MP3, OGG, WebM, AAC • Max ",Math.round(v.maxAudioFileSize/1024/1024),"MB"]})]})})}),(0,s.jsx)("input",{type:"file",accept:"audio/*",multiple:!0,onChange:e=>I(Array.from(e.target.files||[])),className:"hidden",disabled:i})]}),l&&(0,s.jsxs)("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-700 rounded-lg",children:[(0,s.jsx)("p",{className:"text-red-400 text-sm",children:l}),(0,s.jsx)("button",{onClick:h,className:"mt-2 text-xs text-red-300 hover:text-red-200 underline",children:"Dismiss"})]}),p.length>0&&(0,s.jsxs)("div",{className:"mt-3 p-3 bg-yellow-900/20 border border-yellow-700 rounded-lg",children:[(0,s.jsx)("p",{className:"text-yellow-400 text-sm font-medium mb-2",children:"Some files couldn't be uploaded:"}),(0,s.jsx)("ul",{className:"text-yellow-300 text-xs space-y-1",children:p.map((e,t)=>(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-mono",children:e.file}),": ",e.error]},t))}),(0,s.jsx)("button",{onClick:()=>x([]),className:"mt-2 text-xs text-yellow-300 hover:text-yellow-200 underline",children:"Dismiss"})]})]}),(0,s.jsxs)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[0===t.length&&(0,s.jsx)("div",{className:"text-sm text-zinc-500 text-center py-4",children:"No samples loaded yet"}),t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-zinc-800 rounded-lg hover:bg-zinc-750 transition-colors",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-mono text-sm truncate",children:e.name}),"ai"===e.type&&(0,s.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-purple-900 text-purple-300 rounded",children:"AI"}),e.packName&&(0,s.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-emerald-900 text-emerald-300 rounded",children:e.packName})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zinc-500 mt-1",children:[(0,s.jsxs)("span",{children:[e.duration.toFixed(2),"s"]}),e.prompt&&(0,s.jsxs)("span",{className:"truncate italic",children:['"',e.prompt,'"']})]})]}),(0,s.jsx)(m,{content:"Play sample preview",side:"top",children:(0,s.jsx)("button",{onClick:()=>F(e),className:"ml-2 p-2 text-zinc-400 hover:text-emerald-400 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-zinc-800 rounded","aria-label":"Play preview of ".concat(e.name),children:"▶"})})]},e.id))]}),(0,s.jsx)(g,{open:y,onOpenChange:k,title:"Clear AI Sample Cache",description:"Are you sure you want to clear the AI sample cache? This will remove ".concat(z(j.size)," of cached files (").concat(j.files," files). Generated samples will need to be recreated."),confirmText:"Clear Cache",cancelText:"Cancel",variant:"destructive",onConfirm:B}),C&&(0,s.jsx)("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-700 rounded-lg",children:(0,s.jsx)("p",{className:"text-red-400 text-sm",children:C})})]})}function N(e){let{queue:t}=e,{isLoading:a,loadingMessage:n}=d(),r=t.filter(e=>"generating"===e.status),i=t.filter(e=>"ready"===e.status).slice(-5),c=t.filter(e=>"error"===e.status).slice(-3),l=t.filter(e=>"queued"===e.status);return(0,s.jsxs)("div",{className:"bg-zinc-900 text-zinc-100 rounded-2xl p-5 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"Generation Queue"}),(r.length>0||a)&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-purple-500 border-t-transparent rounded-full"}),(0,s.jsx)("span",{className:"text-xs text-purple-400",children:a&&n?n:"Generating..."})]})]}),0===r.length&&0===i.length&&0===c.length&&0===l.length?(0,s.jsx)("div",{className:"text-sm text-zinc-500 text-center py-4",children:"No generations yet"}):(0,s.jsxs)("div",{className:"space-y-3 max-h-48 overflow-y-auto",children:[l.map((e,t)=>(0,s.jsxs)("div",{className:"p-2 bg-blue-900/20 rounded-lg border border-blue-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-mono truncate mr-2",children:e.prompt}),(0,s.jsxs)("span",{className:"text-xs text-blue-400",children:["Queued #",t+1]})]}),e.trackId&&(0,s.jsxs)("div",{className:"text-xs text-blue-300 mt-1",children:["Track: ",e.trackId]})]},e.id)),r.map(e=>(0,s.jsxs)("div",{className:"p-2 bg-purple-900/20 rounded-lg border border-purple-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-sm font-mono truncate mr-2",children:e.prompt}),(0,s.jsx)("span",{className:"text-xs text-purple-400",children:"Generating..."})]}),(0,s.jsx)("div",{className:"w-full bg-zinc-800 rounded-full h-1.5",children:(0,s.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(e.progress||0,"%")}})}),void 0!==e.progress&&(0,s.jsxs)("div",{className:"text-xs text-purple-300 mt-1 text-right",children:[Math.round(e.progress),"%"]}),e.trackId&&(0,s.jsxs)("div",{className:"text-xs text-purple-300 mt-1",children:["Track: ",e.trackId]})]},e.id)),i.map(e=>(0,s.jsx)("div",{className:"p-2 bg-emerald-900/20 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-mono truncate mr-2",children:e.prompt}),(0,s.jsx)("span",{className:"text-xs text-emerald-400",children:"✓ Ready"})]})},e.id)),c.map(e=>(0,s.jsxs)("div",{className:"p-2 bg-red-900/20 rounded-lg border border-red-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-mono truncate mr-2",children:e.prompt}),(0,s.jsx)("span",{className:"text-xs text-red-400",children:"✗ Failed"})]}),e.trackId&&(0,s.jsxs)("div",{className:"text-xs text-red-300 mt-1",children:["Track: ",e.trackId]})]},e.id))]}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-zinc-800",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"Using MusicGen backend • Draft: melody model • HQ: large model"}),t.length>0&&(0,s.jsxs)("span",{className:"text-xs text-zinc-400",children:[r.length+l.length," pending"]})]})})]})}function C(e){let{isPlaying:t,onPlayStop:a,bpm:r,onBpmChange:i,reverse:c,onReverseChange:l,swing:o,onSwingChange:d,masterGain:u,onMasterGainChange:p}=e;return(0,n.useEffect)(()=>{console.log("TransportControls: isPlaying prop changed to:",t)},[t]),(0,s.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,s.jsx)(h,{shortcut:x.PLAY_STOP,description:b("play_stop"),side:"top",children:(0,s.jsx)("button",{onClick:()=>{console.log("TransportControls onClick called, current isPlaying:",t),a()},className:"px-8 py-3 rounded-xl font-bold text-lg transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-zinc-900 ".concat(t?"bg-red-600 hover:bg-red-700 text-white focus:ring-red-400":"bg-emerald-500 hover:bg-emerald-600 text-black focus:ring-emerald-400"),"aria-label":"".concat(t?"Stop":"Play"," sequencer"),"aria-pressed":t,children:t?"■ Stop":"▶ Play"})}),(0,s.jsx)(h,{shortcut:x.REVERSE,description:b("reverse"),side:"top",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:c,onChange:e=>l(e.target.checked),className:"w-4 h-4 cursor-pointer focus:ring-2 focus:ring-blue-400","aria-label":"Toggle reverse playback"}),(0,s.jsx)("span",{className:"text-zinc-400 select-none",children:"Reverse"})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(m,{content:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-medium",children:"Tempo Control"}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400 mt-1",children:["Use ",x.BPM_DECREASE,"/",x.BPM_INCREASE," keys to adjust"]}),(0,s.jsx)("div",{className:"text-xs text-zinc-400",children:"Range: 40-200 BPM"})]}),side:"top",children:(0,s.jsx)("label",{className:"text-sm text-zinc-400 w-16 cursor-help",children:"BPM"})}),(0,s.jsx)("input",{type:"range",min:40,max:200,value:r,onChange:e=>i(parseInt(e.target.value)),className:"flex-1 focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Tempo: ".concat(r," BPM")}),(0,s.jsx)("span",{className:"w-12 text-right tabular-nums text-zinc-300",children:r})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(m,{content:"Add timing variation to off-beat steps (0-100%)",side:"top",children:(0,s.jsx)("label",{className:"text-sm text-zinc-400 w-16 cursor-help",children:"Swing"})}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:o,onChange:e=>d(parseFloat(e.target.value)),className:"flex-1 focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Swing: ".concat((100*o).toFixed(0),"%")}),(0,s.jsxs)("span",{className:"w-12 text-right tabular-nums text-zinc-300",children:[(100*o).toFixed(0),"%"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(m,{content:"Master output volume (affects all tracks)",side:"top",children:(0,s.jsx)("label",{className:"text-sm text-zinc-400 w-16 cursor-help",children:"Master"})}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.01,value:u,onChange:e=>p(parseFloat(e.target.value)),className:"flex-1 focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Master volume: ".concat((100*u).toFixed(0),"%")}),(0,s.jsx)("span",{className:"w-12 text-right tabular-nums text-zinc-300",children:u.toFixed(2)})]})]})]})}var T=a(29),z=a.n(T);let A=e=>{var t;let{tracks:a,selectedTrack:r,onSelectTrack:i,onVolumeChange:c,onMuteToggle:l,onSoloToggle:o,onClearTrack:d}=e,[u,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(null),f=e=>{x(e),h(!0)};return(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 flex flex-col items-center space-y-2",children:[(0,s.jsx)("div",{className:"jsx-a39c00189b444757 bg-zinc-800 rounded-full px-3 py-4 border border-zinc-700",children:(0,s.jsx)("div",{className:"jsx-a39c00189b444757 flex flex-col items-center space-y-1",children:a.map(e=>(0,s.jsx)(m,{content:(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 text-center",children:[(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 font-medium",children:["Track ",e.name]}),(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 text-xs text-zinc-400 mt-1",children:["Volume: ",Math.round(100*e.volume),"%"]}),(0,s.jsx)("div",{className:"jsx-a39c00189b444757 text-xs text-zinc-400",children:e.muted?"Muted":e.solo?"Solo":"Active"}),(0,s.jsx)("div",{className:"jsx-a39c00189b444757 text-xs text-zinc-400 mt-1",children:"Click to select track"})]}),side:"right",children:(0,s.jsx)("button",{onClick:()=>i(e.id),style:{backgroundColor:e.color,color:"#f59e0b"===e.color?"#000":"#fff"},"aria-label":"Select track ".concat(e.name).concat(e.muted?", muted":"").concat(e.solo?", solo":""),"aria-pressed":r===e.id,className:"jsx-a39c00189b444757 "+"\n                  w-8 h-8 rounded-full font-bold text-sm transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-zinc-900\n                  ".concat(r===e.id?"ring-2 ring-blue-400 shadow-lg scale-110 focus:ring-blue-400":"hover:scale-105 focus:ring-blue-400","\n                  ").concat(e.muted?"opacity-50":"","\n                  ").concat(e.solo?"ring-2 ring-yellow-400":"","\n                "),children:e.name})},e.id))})}),r&&(0,s.jsx)("div",{className:"jsx-a39c00189b444757 bg-zinc-800 rounded-lg p-3 border border-zinc-700 min-w-[120px]",children:(()=>{let e=a.find(e=>e.id===r);return e?(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 space-y-3",children:[(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 text-center",children:[(0,s.jsx)("div",{style:{backgroundColor:e.color},className:"jsx-a39c00189b444757 w-6 h-6 rounded-full mx-auto mb-1"}),(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 text-xs text-zinc-400",children:["Track ",e.name]})]}),(0,s.jsxs)("div",{className:"jsx-a39c00189b444757",children:[(0,s.jsx)(m,{content:"Adjust track volume (0-100%)",side:"top",children:(0,s.jsx)("label",{htmlFor:"volume-".concat(e.id),className:"jsx-a39c00189b444757 text-xs text-zinc-400 block mb-1",children:"Volume"})}),(0,s.jsx)("input",{id:"volume-".concat(e.id),type:"range",min:"0",max:"1",step:"0.1",value:e.volume,onChange:t=>c(e.id,parseFloat(t.target.value)),"aria-label":"Track ".concat(e.name," volume: ").concat(Math.round(100*e.volume),"%"),className:"jsx-a39c00189b444757 w-full h-2 bg-zinc-700 rounded-lg appearance-none cursor-pointer slider focus:outline-none focus:ring-2 focus:ring-blue-400"}),(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 text-xs text-zinc-500 text-center mt-1",children:[Math.round(100*e.volume),"%"]})]}),(0,s.jsxs)("div",{className:"jsx-a39c00189b444757 flex space-x-2",children:[(0,s.jsx)(m,{content:e.muted?"Unmute track":"Mute track",side:"top",children:(0,s.jsx)("button",{onClick:()=>l(e.id),"aria-label":"".concat(e.muted?"Unmute":"Mute"," track ").concat(e.name),"aria-pressed":e.muted,className:"jsx-a39c00189b444757 "+"\n                        flex-1 px-2 py-1 text-xs rounded transition-all focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-offset-zinc-800\n                        ".concat(e.muted?"bg-red-600 text-white focus:ring-red-400":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600 focus:ring-blue-400","\n                      "),children:"MUTE"})}),(0,s.jsx)(m,{content:e.solo?"Disable solo":"Solo track (mutes all others)",side:"top",children:(0,s.jsx)("button",{onClick:()=>o(e.id),"aria-label":"".concat(e.solo?"Disable solo for":"Solo"," track ").concat(e.name),"aria-pressed":e.solo,className:"jsx-a39c00189b444757 "+"\n                        flex-1 px-2 py-1 text-xs rounded transition-all focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-offset-zinc-800\n                        ".concat(e.solo?"bg-yellow-600 text-black focus:ring-yellow-400":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600 focus:ring-blue-400","\n                      "),children:"SOLO"})})]}),(0,s.jsx)(m,{content:"Remove all samples from this track",side:"top",children:(0,s.jsx)("button",{onClick:()=>f(e.id),"aria-label":"Clear all samples from track ".concat(e.name),className:"jsx-a39c00189b444757 w-full px-2 py-1 text-xs bg-zinc-700 text-zinc-300 rounded hover:bg-red-600 hover:text-white transition-all focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-1 focus:ring-offset-zinc-800",children:"Clear Track"})})]}):null})()}),(0,s.jsx)(g,{open:u,onOpenChange:h,title:"Clear Track",description:"Are you sure you want to clear all samples from track ".concat(p?null===(t=a.find(e=>e.id===p))||void 0===t?void 0:t.name:"","? This action cannot be undone."),confirmText:"Clear Track",cancelText:"Cancel",variant:"destructive",onConfirm:()=>{p&&(d(p),x(null))}}),(0,s.jsx)(z(),{id:"a39c00189b444757",children:".slider.jsx-a39c00189b444757::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;height:16px;width:16px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;background:#3b82f6;cursor:pointer;border:2px solid#fff;-webkit-box-shadow:0 2px 4px rgba(0,0,0,.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,.2);box-shadow:0 2px 4px rgba(0,0,0,.2)}.slider.jsx-a39c00189b444757::-moz-range-thumb{height:16px;width:16px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;background:#3b82f6;cursor:pointer;border:2px solid#fff;-webkit-box-shadow:0 2px 4px rgba(0,0,0,.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,.2);box-shadow:0 2px 4px rgba(0,0,0,.2)}"})]})},S=[{id:"lofi",name:"Lo-Fi",description:"Warm, nostalgic lo-fi beats and textures",samples:[{prompt:"soft lofi kick drum with vinyl warmth and subtle crackle",name:"Lo-Fi Kick",suggestedTrack:"track1"},{prompt:"mellow lo-fi snare with tape saturation and ambient reverb",name:"Lo-Fi Snare",suggestedTrack:"track2"},{prompt:"warm analog vinyl crackle texture loop",name:"Vinyl Texture",suggestedTrack:"track3"},{prompt:"dreamy lo-fi jazz chord stab with piano warmth",name:"Jazz Stab",suggestedTrack:"track4"}]},{id:"techno",name:"Techno",description:"Industrial techno beats and synthesized elements",samples:[{prompt:"hard industrial techno kick drum with sub bass thump",name:"Techno Kick",suggestedTrack:"track1"},{prompt:"sharp digital techno snare with metallic ring",name:"Techno Snare",suggestedTrack:"track2"},{prompt:"acid techno bass sequence with 303-style resonance",name:"Acid Bass",suggestedTrack:"track3"},{prompt:"industrial techno percussion loop with mechanical sounds",name:"Tech Perc",suggestedTrack:"track4"}]},{id:"trap",name:"Trap",description:"Modern trap drums and 808 elements",samples:[{prompt:"punchy trap kick drum with sub-heavy 808 tail",name:"Trap Kick",suggestedTrack:"track1"},{prompt:"crisp trap snare with tight gate and high-end snap",name:"Trap Snare",suggestedTrack:"track2"},{prompt:"rolling trap hi-hat pattern with triplet swing",name:"Trap Hats",suggestedTrack:"track3"},{prompt:"distorted 808 bass drop with pitch bend and saturation",name:"808 Drop",suggestedTrack:"track4"}]},{id:"house",name:"House",description:"Classic house grooves and dance elements",samples:[{prompt:"four-on-the-floor house kick drum with warm compression",name:"House Kick",suggestedTrack:"track1"},{prompt:"classic house clap with disco-style reverb tail",name:"House Clap",suggestedTrack:"track2"},{prompt:"grooving house bass line with analog filter sweep",name:"House Bass",suggestedTrack:"track3"},{prompt:"funky house stab chord with disco strings and brass",name:"House Stab",suggestedTrack:"track4"}]},{id:"ambient",name:"Ambient",description:"Atmospheric textures and ambient soundscapes",samples:[{prompt:"soft ambient kick drum with ethereal reverb tail",name:"Ambient Kick",suggestedTrack:"track1"},{prompt:"delicate ambient percussion with crystalline texture",name:"Crystal Perc",suggestedTrack:"track2"},{prompt:"evolving ambient pad with warm analog synthesis",name:"Warm Pad",suggestedTrack:"track3"},{prompt:"nature-inspired ambient texture with organic elements",name:"Nature Texture",suggestedTrack:"track4"}]},{id:"detroit",name:"Detroit",description:"Classic Detroit techno with Motor City soul and 90s analog warmth",samples:[{prompt:"deep Detroit techno kick drum with sub-bass weight and analog punch, 90s style",name:"Motor Kick",suggestedTrack:"track1"},{prompt:"vintage Detroit techno snare with metallic snap and reverb tail",name:"Steel Snare",suggestedTrack:"track2"},{prompt:"Detroit-style analog bassline with TB-303 acid resonance and filter sweep",name:"Motor Bass",suggestedTrack:"track3"},{prompt:"Detroit techno stab chord with analog strings and futuristic pads",name:"Future Stab",suggestedTrack:"track4"},{prompt:"classic Detroit techno hi-hat pattern with analog drum machine feel",name:"Motor Hats",suggestedTrack:"track3"},{prompt:"Detroit underground percussion loop with industrial metallic textures",name:"Underground Perc",suggestedTrack:"track4"}]},{id:"berlin",name:"Berlin",description:"Dark Berlin underground techno with 90s warehouse atmosphere",samples:[{prompt:"hard Berlin techno kick drum with underground club punch and sub weight",name:"Warehouse Kick",suggestedTrack:"track1"},{prompt:"sharp Berlin techno snare with digital distortion and warehouse reverb",name:"Concrete Snare",suggestedTrack:"track2"},{prompt:"dark Berlin techno bassline with analog filter modulation and acid texture",name:"Underground Bass",suggestedTrack:"track3"},{prompt:"Berlin-style techno pad with dark atmosphere and analog warmth",name:"Dark Pad",suggestedTrack:"track4"},{prompt:"Berlin techno percussion with metallic industrial sounds and echo",name:"Steel Perc",suggestedTrack:"track2"},{prompt:"haunting Berlin techno lead with analog synthesis and dark character",name:"Shadow Lead",suggestedTrack:"track4"}]},{id:"uk-garage",name:"UK Garage",description:"90s UK garage with skippy beats and bass weight",samples:[{prompt:"classic UK garage kick drum with sub-bass depth and punch",name:"UKG Kick",suggestedTrack:"track1"},{prompt:"skippy UK garage snare with characteristic swing and reverb",name:"Skip Snare",suggestedTrack:"track2"},{prompt:"UK garage hi-hat pattern with distinctive shuffle and swing timing",name:"Shuffle Hats",suggestedTrack:"track3"},{prompt:"deep UK garage bassline with sub weight and characteristic wobble",name:"Deep Bass",suggestedTrack:"track4"},{prompt:"UK garage vocal chop with characteristic pitch shift and reverb",name:"Vocal Chop",suggestedTrack:"track4"}]},{id:"chicago-house",name:"Chicago House",description:"Original Chicago house with 808 drums and classic stabs",samples:[{prompt:"Chicago house 808 kick drum with sub-bass thump and vinyl warmth",name:"Chi Kick",suggestedTrack:"track1"},{prompt:"classic Chicago house clap with reverb tail and disco flavor",name:"Chi Clap",suggestedTrack:"track2"},{prompt:"Chicago house hi-hat pattern with analog drum machine swing",name:"Chi Hats",suggestedTrack:"track3"},{prompt:"iconic Chicago house piano stab with gospel chord progression",name:"Piano Stab",suggestedTrack:"track4"},{prompt:"Chicago house bassline with analog filter and groove",name:"Chi Bass",suggestedTrack:"track3"}]},{id:"jungle",name:"Jungle",description:"90s jungle with chopped breaks and sub-bass",samples:[{prompt:"jungle kick drum with sub-bass depth and analog punch",name:"Jungle Kick",suggestedTrack:"track1"},{prompt:"chopped jungle snare from Amen break with distortion",name:"Amen Snare",suggestedTrack:"track2"},{prompt:"rapid jungle hi-hat pattern with breakbeat timing",name:"Break Hats",suggestedTrack:"track3"},{prompt:"deep jungle bassline with wobble and sub frequencies",name:"Sub Bass",suggestedTrack:"track4"},{prompt:"jungle vocal sample with ragga style and reverb",name:"Ragga Vocal",suggestedTrack:"track4"}]},{id:"drum-n-bass",name:"Drum & Bass",description:"Liquid and hard D&B with tight breaks",samples:[{prompt:"drum and bass kick with tight punch and sub-bass weight",name:"DnB Kick",suggestedTrack:"track1"},{prompt:"crisp drum and bass snare with electronic processing",name:"DnB Snare",suggestedTrack:"track2"},{prompt:"fast drum and bass hi-hat with liquid groove",name:"Liquid Hats",suggestedTrack:"track3"},{prompt:"rolling drum and bass bassline with neuro modulation",name:"Neuro Bass",suggestedTrack:"track4"},{prompt:"atmospheric drum and bass pad with ambient texture",name:"Liquid Pad",suggestedTrack:"track4"}]},{id:"breakbeat",name:"Breakbeat",description:"Classic breakbeat with funky breaks and samples",samples:[{prompt:"breakbeat kick drum with analog punch and vinyl character",name:"Break Kick",suggestedTrack:"track1"},{prompt:"funky breakbeat snare with classic break sampling",name:"Funky Snare",suggestedTrack:"track2"},{prompt:"breakbeat hi-hat pattern with shuffle and swing",name:"Shuffle Break",suggestedTrack:"track3"},{prompt:"breakbeat bassline with funk groove and analog warmth",name:"Funk Bass",suggestedTrack:"track4"},{prompt:"breakbeat vocal chop with hip-hop flavor",name:"Break Vocal",suggestedTrack:"track4"}]},{id:"acid",name:"Acid",description:"TB-303 acid sounds with squelchy resonance",samples:[{prompt:"acid kick drum with sub-bass and analog character",name:"Acid Kick",suggestedTrack:"track1"},{prompt:"acid snare with metallic ring and reverb",name:"Acid Snare",suggestedTrack:"track2"},{prompt:"TB-303 acid bassline with resonant filter sweeps",name:"303 Bass",suggestedTrack:"track3"},{prompt:"acid lead with squelchy 303 modulation and distortion",name:"Acid Lead",suggestedTrack:"track4"},{prompt:"acid percussion with metallic textures",name:"Acid Perc",suggestedTrack:"track2"}]},{id:"minimal",name:"Minimal",description:"Minimal techno with subtle textures and space",samples:[{prompt:"minimal techno kick with deep sub and clean attack",name:"Min Kick",suggestedTrack:"track1"},{prompt:"minimal techno snare with subtle reverb and space",name:"Min Snare",suggestedTrack:"track2"},{prompt:"minimal techno hi-hat with precise timing and texture",name:"Min Hats",suggestedTrack:"track3"},{prompt:"minimal techno bassline with subtle modulation",name:"Min Bass",suggestedTrack:"track4"},{prompt:"minimal percussion with organic texture and space",name:"Min Perc",suggestedTrack:"track3"}]},{id:"dub",name:"Dub",description:"Dub techno with deep echoes and analog warmth",samples:[{prompt:"dub techno kick with deep sub-bass and analog warmth",name:"Dub Kick",suggestedTrack:"track1"},{prompt:"dub techno snare with tape delay and reverb",name:"Dub Snare",suggestedTrack:"track2"},{prompt:"dub techno hi-hat with analog delay and modulation",name:"Dub Hats",suggestedTrack:"track3"},{prompt:"dub techno chord with analog delay and filtering",name:"Dub Chord",suggestedTrack:"track4"},{prompt:"dub techno bass with deep sub and analog character",name:"Dub Bass",suggestedTrack:"track3"}]},{id:"trance",name:"Trance",description:"Classic trance with emotional leads and pumping beats",samples:[{prompt:"trance kick drum with pumping compression and sub-bass",name:"Trance Kick",suggestedTrack:"track1"},{prompt:"trance snare with gated reverb and emotional character",name:"Trance Snare",suggestedTrack:"track2"},{prompt:"trance hi-hat with driving rhythm and analog feel",name:"Trance Hats",suggestedTrack:"track3"},{prompt:"emotional trance lead with supersaw and reverb",name:"Trance Lead",suggestedTrack:"track4"},{prompt:"trance pluck with analog filtering and modulation",name:"Trance Pluck",suggestedTrack:"track4"}]},{id:"experimental",name:"Experimental",description:"Avant-garde sounds and unconventional textures",samples:[{prompt:"experimental kick with granular synthesis and texture",name:"Exp Kick",suggestedTrack:"track1"},{prompt:"glitchy experimental snare with digital artifacts",name:"Glitch Snare",suggestedTrack:"track2"},{prompt:"experimental texture with field recording and processing",name:"Field Texture",suggestedTrack:"track3"},{prompt:"abstract experimental sound with spectral processing",name:"Abstract Sound",suggestedTrack:"track4"},{prompt:"experimental percussion with found sounds and effects",name:"Found Perc",suggestedTrack:"track2"}]}];function M(e,t,a){let s=e.samples[t];return{id:l(),name:s.name,buffer:a,duration:a.duration,type:"ai",prompt:s.prompt,packId:e.id,packName:e.name}}var R=a(257);async function I(e){if(!v.isStaticMode)throw Error("Static samples only available in static mode");return R.env.NEXT_PUBLIC_HUGGINGFACE_API_KEY?await E(e):P(e)}async function E(e){try{let t=await fetch("https://api-inference.huggingface.co/models/facebook/musicgen-small",{headers:{Authorization:"Bearer ".concat(R.env.NEXT_PUBLIC_HUGGINGFACE_API_KEY),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({inputs:e,parameters:{duration:8}})});if(!t.ok)throw Error("HuggingFace API error: ".concat(t.status));let a=await t.blob(),s=await a.arrayBuffer(),n=new AudioContext,r=await n.decodeAudioData(s);return{id:l(),name:"AI: ".concat(e.slice(0,20)).concat(e.length>20?"...":""),buffer:r,duration:r.duration,type:"ai",prompt:e}}catch(t){return console.error("HuggingFace generation failed:",t),P(e)}}async function P(e){let t=new AudioContext,a=t.sampleRate,s=2*a,n=t.createBuffer(1,s,a),r=n.getChannelData(0),i=function(e){let t=e.toLowerCase();return t.includes("kick")||t.includes("bass")?60:t.includes("snare")?200:t.includes("hat")||t.includes("cymbal")?8e3:t.includes("lead")||t.includes("melody")?440:t.includes("pad")||t.includes("ambient")?220:330}(e),c=function(e){let t=e.toLowerCase();return t.includes("kick")||t.includes("snare")?(e,t)=>Math.exp(-(8*e))*(e<.1?1:Math.exp(-(20*(e-.1)))):t.includes("pad")||t.includes("ambient")?(e,t)=>Math.min(4*e,1)*(1-e/t):(e,t)=>Math.exp(-(2*e))*(1-e/t)}(e);for(let t=0;t<s;t++){let s=t/a,n=c(s,2);e.toLowerCase().includes("kick")?r[t]=Math.sin(2*Math.PI*i*s)*n*.8:e.toLowerCase().includes("snare")?r[t]=(2*Math.random()-1)*n*.6:e.toLowerCase().includes("hat")?r[t]=(2*Math.random()-1)*n*.4:r[t]=Math.sin(2*Math.PI*i*s)*n*.5}return{id:l(),name:"Mock: ".concat(e.slice(0,20)).concat(e.length>20?"...":""),buffer:n,duration:n.duration,type:"ai",prompt:e}}function D(e){let{onPackLoad:t}=e,[a,i]=(0,n.useState)(null),[c,l]=(0,n.useState)(null),{addToLibrary:o,assignToStepMulti:u,setLoading:h,setError:p,tracks:g}=d(),x=async e=>{i(e.id),h(!0,"Loading ".concat(e.name," sample pack..."));try{let a=new(window.AudioContext||window.webkitAudioContext);"suspended"===a.state&&await a.resume();let s=w();for(let t=0;t<e.samples.length;t++){let n=e.samples[t];try{let i;if(h(!0,"Generating ".concat(n.name,"... (").concat(t+1,"/").concat(e.samples.length,")")),v.isStaticMode)(i=await I(n.prompt)).name=n.name;else{let c=(await r.Z.post("".concat(s,"/generate"),{prompt:n.prompt,quality:"draft",duration:8,cfg_coef:7.5})).data.audio,l=await a.decodeAudioData(Uint8Array.from(atob(c),e=>e.charCodeAt(0)).buffer);i=M(e,t,l)}if(o(i),n.suggestedTrack){let e=g.find(e=>e.id===n.suggestedTrack);if(e){let t=e.steps.findIndex(e=>!e.buffer);-1!==t&&u(n.suggestedTrack,t,i.id)}}}catch(t){console.error("Failed to generate ".concat(n.name,":"),t);let e=t instanceof Error?t.message:"Unknown error";p("Failed to generate ".concat(n.name,": ").concat(e,". Please check your backend connection."))}}null==t||t(e.id),l(null)}catch(t){p("Failed to load ".concat(e.name," pack: ").concat(t instanceof Error?t.message:"Unknown error"))}finally{i(null),h(!1)}},f=async(e,t)=>{let a=e.samples[t];h(!0,"Generating ".concat(a.name,"..."));try{let s;let n=new(window.AudioContext||window.webkitAudioContext);if("suspended"===n.state&&await n.resume(),v.isStaticMode)(s=await I(a.prompt)).name=a.name;else{let i=w(),c=(await r.Z.post("".concat(i,"/generate"),{prompt:a.prompt,quality:"draft",duration:8,cfg_coef:7.5})).data.audio,l=await n.decodeAudioData(Uint8Array.from(atob(c),e=>e.charCodeAt(0)).buffer);s=M(e,t,l)}if(o(s),a.suggestedTrack){let e=g.find(e=>e.id===a.suggestedTrack);if(e){let t=e.steps.findIndex(e=>!e.buffer);-1!==t&&u(a.suggestedTrack,t,s.id)}}}catch(t){let e=t instanceof Error?t.message:"Unknown error";p("Failed to generate ".concat(a.name,": ").concat(e,". Please check your backend connection."))}finally{h(!1)}};return(0,s.jsxs)("div",{className:"bg-zinc-900 text-zinc-100 rounded-2xl p-5 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold",children:"AI Sample Packs"}),(0,s.jsxs)("span",{className:"text-sm text-zinc-400",children:[S.length," curated packs"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,s.jsxs)("div",{className:"border border-zinc-700 rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"p-3 bg-zinc-800 cursor-pointer hover:bg-zinc-750 transition-colors",onClick:()=>l(c===e.id?null:e.id),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-zinc-400 mt-1",children:e.description})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m,{content:"Load all ".concat(e.samples.length," samples and auto-assign to tracks"),side:"top",children:(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),x(e)},disabled:a===e.id,className:"px-3 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-all disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-400",children:a===e.id?"Loading...":"Load Pack"})}),(0,s.jsx)("span",{className:"text-xs text-zinc-500",children:c===e.id?"▲":"▼"})]})]})}),c===e.id&&(0,s.jsx)("div",{className:"p-3 bg-zinc-850 border-t border-zinc-700",children:(0,s.jsx)("div",{className:"space-y-2",children:e.samples.map((t,a)=>{var n,r,i;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-zinc-800 rounded",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:t.name}),t.suggestedTrack&&(0,s.jsxs)("span",{className:"px-1.5 py-0.5 text-xs rounded",style:{backgroundColor:(null===(n=g.find(e=>e.id===t.suggestedTrack))||void 0===n?void 0:n.color)+"20",color:null===(r=g.find(e=>e.id===t.suggestedTrack))||void 0===r?void 0:r.color},children:["Track ",null===(i=g.find(e=>e.id===t.suggestedTrack))||void 0===i?void 0:i.name]})]}),(0,s.jsxs)("p",{className:"text-xs text-zinc-400 truncate italic",children:['"',t.prompt,'"']})]}),(0,s.jsx)(m,{content:"Generate this sample",side:"top",children:(0,s.jsx)("button",{onClick:()=>f(e,a),className:"ml-2 px-2 py-1 text-xs bg-emerald-600 hover:bg-emerald-700 text-white rounded transition-all focus:outline-none focus:ring-2 focus:ring-emerald-400",children:"Generate"})})]},a)})})})]},e.id))}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-zinc-800",children:(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"Sample packs provide curated AI prompts designed for multi-track arrangement. Individual samples auto-assign to suggested tracks for quick setup."})})]})}function F(){let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!1),{library:i,setSelectedTrack:c}=d();return((0,n.useEffect)(()=>{let t=setTimeout(()=>{0!==i.length||e||r(!0)},2e3);return()=>clearTimeout(t)},[i.length,e]),(0,n.useEffect)(()=>{e||(c("track1"),t(!0))},[e,c]),a)?(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50 bg-gradient-to-r from-emerald-600 to-purple-600 text-white p-4 rounded-lg shadow-lg max-w-sm border border-emerald-400",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"text-2xl",children:"\uD83D\uDE80"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-sm",children:"Welcome to ORBITR!"}),(0,s.jsx)("p",{className:"text-xs mt-1 opacity-90",children:"Get started by loading an AI sample pack or upload your own audio files."}),(0,s.jsxs)("p",{className:"text-xs mt-2 text-emerald-200",children:[(0,s.jsx)("strong",{children:"Quick start:"}),' Try the "',S[0].name,'" pack below!']}),(0,s.jsx)("button",{onClick:()=>r(!1),className:"mt-2 text-xs underline hover:no-underline opacity-75",children:"Dismiss"})]})]})}):null}class B{async initialize(e,t){if(this.audioContext=e,this.analyserNode=e.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.3,t)t.connect(this.analyserNode);else{let t=e.destination;this.analyserNode.connect(t)}let a=this.analyserNode.frequencyBinCount;this.dataArray=new Uint8Array(new ArrayBuffer(a)),this.frequencyData=new Float32Array(new ArrayBuffer(4*a)),this.calculateFrequencyRanges(),console.log("Audio analysis engine initialized")}calculateFrequencyRanges(){if(!this.audioContext||!this.analyserNode)return;let e=this.audioContext.sampleRate,t=this.analyserNode.frequencyBinCount,a=e/2/t;this.bassRange=[Math.floor(20/a),Math.floor(250/a)],this.lowMidRange=[Math.floor(250/a),Math.floor(500/a)],this.midRange=[Math.floor(500/a),Math.floor(2e3/a)],this.highMidRange=[Math.floor(2e3/a),Math.floor(4e3/a)],this.trebleRange=[Math.floor(4e3/a),Math.min(t-1,Math.floor(2e4/a))]}start(){!this.isActive&&this.analyserNode&&this.dataArray&&(this.isActive=!0,this.analyze())}stop(){this.isActive=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}calculateAnalysisData(){if(!this.dataArray||!this.frequencyData)return this.getEmptyAnalysisData();let e=0,t=0;for(let a=0;a<this.dataArray.length;a++){let s=(this.dataArray[a]-128)/128;e+=s*s,t=Math.max(t,Math.abs(s))}let a=Math.sqrt(e/this.dataArray.length),s=this.getFrequencyBandAverage(this.bassRange),n=this.getFrequencyBandAverage(this.lowMidRange),r=this.getFrequencyBandAverage(this.midRange),i=this.getFrequencyBandAverage(this.highMidRange),c=this.getFrequencyBandAverage(this.trebleRange),l=Math.min(1,(s+r+c)/3);this.updateHistory(a,t,l);let o=this.getHistoryAverage(this.rmsHistory),d=this.getHistoryAverage(this.peakHistory),u=this.getHistoryAverage(this.energyHistory);return{rms:a,peak:t,bass:s,lowMid:n,mid:r,highMid:i,treble:c,spectrum:new Float32Array(this.frequencyData),energy:l,brightness:c/Math.max(.01,s+n+r+i+c),warmth:s/Math.max(.01,s+n+r+i+c),smoothRms:o,smoothPeak:d,smoothEnergy:u}}getFrequencyBandAverage(e){let[t,a]=e;if(!this.dataArray)return 0;let s=0,n=0;for(let e=t;e<=a&&e<this.dataArray.length;e++)s+=this.dataArray[e]/255,n++;return n>0?s/n:0}updateHistory(e,t,a){this.rmsHistory.push(e),this.peakHistory.push(t),this.energyHistory.push(a),this.rmsHistory.length>this.historyLength&&(this.rmsHistory.shift(),this.peakHistory.shift(),this.energyHistory.shift())}getHistoryAverage(e){return 0===e.length?0:e.reduce((e,t)=>e+t,0)/e.length}getEmptyAnalysisData(){return{rms:0,peak:0,bass:0,lowMid:0,mid:0,highMid:0,treble:0,spectrum:new Float32Array(1024),energy:0,brightness:0,warmth:0,smoothRms:0,smoothPeak:0,smoothEnergy:0}}onAnalysis(e){return this.callbacks.push(e),()=>{let t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)}}static getColorTemperature(e,t){return{h:t>e?30+60*t:180+120*e,s:.6+.4*Math.abs(e-t),l:.3+.4*Math.max(e,t)}}static getVisualizationIntensity(e,t){return .7*e+.3*t}cleanup(){this.stop(),this.analyserNode&&(this.analyserNode.disconnect(),this.analyserNode=null),this.audioContext=null,this.dataArray=null,this.frequencyData=null,this.callbacks=[],this.rmsHistory=[],this.peakHistory=[],this.energyHistory=[]}constructor(){this.analyserNode=null,this.audioContext=null,this.dataArray=null,this.frequencyData=null,this.rmsHistory=[],this.peakHistory=[],this.energyHistory=[],this.historyLength=30,this.bassRange=[0,0],this.lowMidRange=[0,0],this.midRange=[0,0],this.highMidRange=[0,0],this.trebleRange=[0,0],this.isActive=!1,this.animationFrameId=null,this.callbacks=[],this.analyze=()=>{if(!this.isActive||!this.analyserNode||!this.dataArray||!this.frequencyData)return;this.analyserNode.getByteFrequencyData(this.dataArray),this.analyserNode.getFloatFrequencyData(this.frequencyData);let e=this.calculateAnalysisData();this.callbacks.forEach(t=>t(e)),this.animationFrameId=requestAnimationFrame(this.analyze)}}}let G=new B,L={primary:"hsl(160, 84%, 39%)",secondary:"hsl(263, 70%, 50%)",accent:"hsl(45, 93%, 47%)",success:"hsl(142, 76%, 36%)",warning:"hsl(38, 92%, 50%)",error:"hsl(0, 84%, 60%)",info:"hsl(217, 91%, 60%)",background:"hsl(240, 10%, 4%)",surface:"hsl(240, 6%, 10%)",border:"hsl(240, 5%, 20%)",text:{primary:"hsl(0, 0%, 95%)",secondary:"hsl(240, 5%, 70%)",tertiary:"hsl(240, 5%, 50%)"}},q={trackO:{base:[0,84,60],bassInfluence:.8,midInfluence:.3,trebleInfluence:.1,energyInfluence:.5,saturationRange:[60,90],lightnessRange:[40,70]},trackR:{base:[217,91,60],bassInfluence:.2,midInfluence:.6,trebleInfluence:.8,energyInfluence:.4,saturationRange:[70,95],lightnessRange:[45,75]},trackB:{base:[142,76,36],bassInfluence:.4,midInfluence:.8,trebleInfluence:.3,energyInfluence:.6,saturationRange:[65,85],lightnessRange:[35,65]},trackI:{base:[45,93,47],bassInfluence:.6,midInfluence:.4,trebleInfluence:.7,energyInfluence:.8,saturationRange:[80,100],lightnessRange:[40,70]},background:{base:[240,10,4],bassInfluence:.3,midInfluence:.1,trebleInfluence:.05,energyInfluence:.2,saturationRange:[5,20],lightnessRange:[3,8]},accent:{base:[160,84,39],bassInfluence:.2,midInfluence:.4,trebleInfluence:.6,energyInfluence:.7,saturationRange:[70,90],lightnessRange:[35,55]}},U={px:"1px",0:"0",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",11:"2.75rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},_={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},H={instant:"0ms",fast:"150ms",normal:"300ms",slow:"500ms",slower:"750ms",slowest:"1000ms"};function O(e,t){let a=q[e];if(!a)return L.primary;let[s,n,r]=a.base,i=t.bass*a.bassInfluence,c=i+t.mid*a.midInfluence+t.treble*a.trebleInfluence+t.energy*a.energyInfluence,[l,o]=a.saturationRange,[d,u]=a.lightnessRange,m=(t.brightness-t.warmth)*10;return"hsl(".concat((s+m)%360,", ").concat(l+c*(o-l),"%, ").concat(d+c*(u-d),"%)")}function K(e){let t={"--color-primary":L.primary,"--color-secondary":L.secondary,"--color-accent":L.accent,"--color-success":L.success,"--color-warning":L.warning,"--color-error":L.error,"--color-info":L.info,"--color-background":L.background,"--color-surface":L.surface,"--color-border":L.border,"--color-text-primary":L.text.primary,"--color-text-secondary":L.text.secondary,"--color-text-tertiary":L.text.tertiary,...Object.entries(U).reduce((e,t)=>{let[a,s]=t;return e["--spacing-".concat(a)]=s,e},{}),...Object.entries(_).reduce((e,t)=>{let[a,s]=t;return e["--radius-".concat(a)]=s,e},{}),...Object.entries(H).reduce((e,t)=>{let[a,s]=t;return e["--duration-".concat(a)]=s,e},{})};return e&&(t["--color-track-o"]=O("trackO",e),t["--color-track-r"]=O("trackR",e),t["--color-track-b"]=O("trackB",e),t["--color-track-i"]=O("trackI",e),t["--color-background-reactive"]=function(e){let t=e.warmth>e.brightness?"warm":"cool",a=Math.min(1,2*e.smoothEnergy);if("warm"===t){let t=15+20*e.bass;return"hsl(".concat(t,", ").concat(5+15*a,"%, ").concat(3+5*a,"%)")}{let t=220+40*e.treble;return"hsl(".concat(t,", ").concat(8+12*a,"%, ").concat(4+4*a,"%)")}}(e),t["--audio-energy"]=e.energy.toString(),t["--audio-bass"]=e.bass.toString(),t["--audio-treble"]=e.treble.toString(),t["--audio-brightness"]=e.brightness.toString(),t["--audio-warmth"]=e.warmth.toString()),t}class Q{setupCanvas(){let{width:e,height:t,pixelRatio:a}=this.config;this.canvas.width=e*a,this.canvas.height=t*a,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px"),this.ctx.scale(a,a),this.ctx.imageSmoothingEnabled=!0,this.ctx.lineCap="round",this.ctx.lineJoin="round"}initializeVisualizationElements(){let{width:e,height:t}=this.config,a=e/2,s=t/2;this.backgroundGradient=this.ctx.createRadialGradient(a,s,0,a,s,Math.max(e,t)/2),this.backgroundGradient.addColorStop(0,"rgba(16, 16, 20, 0.95)"),this.backgroundGradient.addColorStop(1,"rgba(8, 8, 12, 1)");let n=.15*Math.min(e,t);this.waveformRings=[{radius:n+60,color:"#ef4444",intensity:0,rotation:0,segments:64,amplitudes:Array(64).fill(0)},{radius:n+40,color:"#3b82f6",intensity:0,rotation:0,segments:64,amplitudes:Array(64).fill(0)},{radius:n+20,color:"#10b981",intensity:0,rotation:0,segments:64,amplitudes:Array(64).fill(0)},{radius:n,color:"#f59e0b",intensity:0,rotation:0,segments:64,amplitudes:Array(64).fill(0)}],this.initializeParticles()}initializeParticles(){let{width:e,height:t}=this.config;this.particles=[];for(let a=0;a<50;a++)this.particles.push(this.createParticle(e,t))}createParticle(e,t){let a=["ambient","bass","treble","energy"];return{x:Math.random()*e,y:Math.random()*t,vx:(Math.random()-.5)*.5,vy:(Math.random()-.5)*.5,life:100*Math.random(),maxLife:100+200*Math.random(),size:1+3*Math.random(),color:[255,255,255,.1+.3*Math.random()],type:a[Math.floor(Math.random()*a.length)]}}updateAudioData(e){this.audioData=e,this.waveformRings.length>=4&&(this.waveformRings[0].intensity=e.bass,this.waveformRings[1].intensity=e.mid,this.waveformRings[2].intensity=e.mid,this.waveformRings[3].intensity=e.treble,this.waveformRings.forEach((t,a)=>{let s=Math.floor(a/4*e.spectrum.length),n=Math.floor((a+1)/4*e.spectrum.length);for(let a=0;a<t.segments;a++){let r=s+Math.floor(a/t.segments*(n-s)),i=Math.abs(e.spectrum[r]||0)/100;t.amplitudes[a]=.7*t.amplitudes[a]+.3*i}}))}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.animate())}stop(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}updateFpsCounter(e){this.frameCount++,e-this.fpsTimer>=1e3&&(this.actualFps=this.frameCount,this.frameCount=0,this.fpsTimer=e)}update(e){let{width:t,height:a}=this.config;this.particles.forEach(s=>{this.updateParticle(s,e,t,a)}),this.waveformRings.forEach((t,a)=>{t.rotation+=(.5+2*t.intensity)*e*.001,this.audioData&&(t.color=O("track".concat(["O","R","B","I"][a]),this.audioData))}),this.audioData&&this.audioData.energy>.5&&this.particles.length<100&&Math.random()<.1*this.audioData.energy&&this.particles.push(this.createParticle(t,a)),this.particles=this.particles.filter(e=>e.life>0)}updateParticle(e,t,a,s){if(e.x+=e.vx*t,e.y+=e.vy*t,e.life-=.02*t,this.audioData){let t=this.getAudioInfluenceForParticle(e);if("ambient"===e.type){let n=s/2,r=a/2-e.x,i=n-e.y,c=Math.sqrt(r*r+i*i);c>0&&(e.vx+=r/c*t*.01,e.vy+=i/c*t*.01)}e.vx+=(Math.random()-.5)*t*.02,e.vy+=(Math.random()-.5)*t*.02,e.size=1+3*t,e.color[3]=e.life/e.maxLife*(.3+.7*t)}e.vx*=.99,e.vy*=.99,e.x<0&&(e.x=a),e.x>a&&(e.x=0),e.y<0&&(e.y=s),e.y>s&&(e.y=0)}getAudioInfluenceForParticle(e){if(!this.audioData)return 0;switch(e.type){case"bass":return this.audioData.bass;case"treble":return this.audioData.treble;case"energy":return this.audioData.energy;default:return this.audioData.smoothEnergy}}render(){let{width:e,height:t}=this.config;this.ctx.clearRect(0,0,e,t),this.backgroundGradient&&(this.ctx.fillStyle=this.backgroundGradient,this.ctx.fillRect(0,0,e,t)),this.renderBackgroundEffects(),this.renderParticles(),this.renderWaveformRings()}renderBackgroundEffects(){if(!this.audioData)return;let{width:e,height:t}=this.config,a=e/2,s=t/2,n=this.audioData.smoothEnergy;if(n>.1){let r=(e+t)/4,i=this.ctx.createRadialGradient(a,s,.5*r,a,s,r*(1+.5*n)),c=.1*n;i.addColorStop(0,"rgba(16, 185, 129, ".concat(c,")")),i.addColorStop(.5,"rgba(139, 92, 246, ".concat(.5*c,")")),i.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,e,t)}}renderParticles(){this.particles.forEach(e=>{let[t,a,s,n]=e.color;this.ctx.save(),this.ctx.globalAlpha=n,this.ctx.fillStyle="rgb(".concat(t,", ").concat(a,", ").concat(s,")"),this.ctx.shadowColor=this.ctx.fillStyle,this.ctx.shadowBlur=2*e.size,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()})}renderWaveformRings(){let{width:e,height:t}=this.config,a=e/2,s=t/2;this.waveformRings.forEach(e=>{this.ctx.save();let t=.3+.7*e.intensity;this.ctx.strokeStyle=e.color.replace(")",", ".concat(t,")")).replace("rgb","rgba"),this.ctx.lineWidth=2+3*e.intensity,this.ctx.shadowColor=e.color,this.ctx.shadowBlur=10*e.intensity,this.ctx.translate(a,s),this.ctx.rotate(e.rotation),this.ctx.beginPath();for(let t=0;t<e.segments;t++){let a=t/e.segments*Math.PI*2,s=e.amplitudes[t]||0,n=e.radius+20*s,r=Math.cos(a)*n,i=Math.sin(a)*n;0===t?this.ctx.moveTo(r,i):this.ctx.lineTo(r,i)}this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()})}renderDebugInfo(){this.ctx.save(),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.font="12px monospace",["FPS: ".concat(this.actualFps),"Particles: ".concat(this.particles.length),...this.audioData?["Energy: ".concat(this.audioData.energy.toFixed(2)),"Bass: ".concat(this.audioData.bass.toFixed(2)),"Treble: ".concat(this.audioData.treble.toFixed(2))]:[]].forEach((e,t)=>{this.ctx.fillText(e,10,20+15*t)}),this.ctx.restore()}setIntensity(e){this.waveformRings.forEach(t=>{t.intensity=Math.max(t.intensity,e)})}addBurst(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=5+Math.floor(10*a);for(let n=0;n<s;n++){let r=n/s*Math.PI*2,i=1+3*a;this.particles.push({x:e,y:t,vx:Math.cos(r)*i,vy:Math.sin(r)*i,life:50+100*a,maxLife:50+100*a,size:2+3*a,color:[255,255,255,.8],type:"energy"})}}resize(e,t){this.config.width=e,this.config.height=t,this.setupCanvas(),this.initializeVisualizationElements()}cleanup(){this.stop(),this.particles=[],this.waveformRings=[]}get fps(){return this.actualFps}get particleCount(){return this.particles.length}constructor(e,t={}){var a=this;this.isRunning=!1,this.animationId=null,this.lastFrameTime=0,this.particles=[],this.waveformRings=[],this.backgroundGradient=null,this.audioData=null,this.frameCount=0,this.fpsTimer=0,this.actualFps=0,this.animate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();if(!a.isRunning)return;let t=e-a.lastFrameTime;t>=1e3/a.config.fps&&(a.update(t),a.render(),a.lastFrameTime=e,a.updateFpsCounter(e)),a.animationId=requestAnimationFrame(a.animate)},this.canvas=e;let s=e.getContext("2d");if(!s)throw Error("Canvas 2D context not available");this.ctx=s,this.config={width:e.width||800,height:e.height||600,pixelRatio:window.devicePixelRatio||1,fps:60,...t},this.setupCanvas(),this.initializeVisualizationElements()}}let V={gentle:{stiffness:120,damping:14,mass:1,precision:.01},stiff:{stiffness:210,damping:20,mass:1,precision:.01},bouncy:{stiffness:400,damping:8,mass:1,precision:.01},energetic:{stiffness:300,damping:10,mass:1,precision:.01}};class W{animate(e,t){var a,s;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.gentle,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,l=this.targets.get(e);this.targets.set(e,{value:null!==(a=null!=i?i:null==l?void 0:l.value)&&void 0!==a?a:t,velocity:null!==(s=null!=c?c:null==l?void 0:l.velocity)&&void 0!==s?s:0,target:t,config:n}),r&&this.callbacks.set(e,r),this.isRunning||this.start()}setTarget(e,t){let a=this.targets.get(e);a&&(a.target=t,this.isRunning||this.start())}getValue(e){let t=this.targets.get(e);return t?{value:t.value,velocity:t.velocity}:null}remove(e){this.targets.delete(e),this.callbacks.delete(e),0===this.targets.size&&this.stop()}clear(){this.targets.clear(),this.callbacks.clear(),this.stop()}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.tick())}stop(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}update(e){let t=[];for(let[a,s]of Array.from(this.targets.entries())){let n=this.updateTarget(s,e),r=this.callbacks.get(a);r&&r(s.value,s.velocity),n&&t.push(a)}t.forEach(e=>{this.targets.delete(e)}),this.frameCount++}updateTarget(e,t){let{stiffness:a,damping:s,mass:n,precision:r}=e.config,i=e.value-e.target,c=-s*e.velocity,l=e.velocity+(-a*i+c)/n*t,o=(e.velocity+l)/2,d=e.value+o*t;return e.velocity=l,e.value=d,!!(Math.abs(i)<r&&Math.abs(e.velocity)<r)&&(e.value=e.target,e.velocity=0,!0)}animateScale(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.bouncy,s="scale-".concat(e.id||Math.random());this.animate(s,t,a,t=>{e.style.transform="scale(".concat(t,")")},1)}animateOpacity(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.gentle,s="opacity-".concat(e.id||Math.random()),n=parseFloat(e.style.opacity||"1");this.animate(s,t,a,t=>{e.style.opacity=t.toString()},n)}animatePosition(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.stiff,n="posX-".concat(e.id||Math.random()),r="posY-".concat(e.id||Math.random()),i=e.style.transform,c=this.extractTransformValue(i,"translateX")||0,l=this.extractTransformValue(i,"translateY")||0;this.animate(n,t,s,void 0,c),this.animate(r,a,s,void 0,l);let o=()=>{var t,a;let s=(null===(t=this.getValue(n))||void 0===t?void 0:t.value)||0,i=(null===(a=this.getValue(r))||void 0===a?void 0:a.value)||0;e.style.transform="translate(".concat(s,"px, ").concat(i,"px)")};this.callbacks.set(n,o),this.callbacks.set(r,o)}extractTransformValue(e,t){let a=new RegExp("".concat(t,"\\(([^)]+)\\)")),s=e.match(a);return s?parseFloat(s[1]):null}sequence(e){e.forEach((e,t)=>{setTimeout(()=>{this.animate(e.key,e.target,e.config,e.callback)},e.delay||100*t)})}stagger(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.gentle,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,n=arguments.length>4?arguments[4]:void 0;e.forEach((e,r)=>{let i=Array.isArray(t)?t[r]:t;setTimeout(()=>{this.animate(e,i,a,n?(t,a)=>n(e,t,a):void 0)},r*s)})}audioReactive(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.energetic,r=arguments.length>5?arguments[5]:void 0;this.animate(e,t+s*a,n,r)}getStats(){return{activeAnimations:this.targets.size,frameCount:this.frameCount,isRunning:this.isRunning}}constructor(){var e=this;this.targets=new Map,this.callbacks=new Map,this.isRunning=!1,this.animationId=null,this.lastTime=0,this.frameCount=0,this.maxDeltaTime=16.67,this.tick=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();if(!e.isRunning)return;let a=Math.min(t-e.lastTime,e.maxDeltaTime);e.lastTime=t,a>0&&e.update(a/1e3),e.targets.size>0?e.animationId=requestAnimationFrame(e.tick):e.stop()},this.lastTime=performance.now()}}let Y=new W,X={x:220,y:220};function Z(e){let{isPlaying:t,currentStep:a,onStepClick:r,onPlayheadClick:i,audioContext:l}=e,o=(0,n.useRef)(null),u=(0,n.useRef)(null),[m,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(!1),{tracks:x,selectedTrack:f,selectedStep:b,setSelectedTrack:y,setSelectedStep:k,toggleStepMulti:v}=d();(0,n.useEffect)(()=>{l&&o.current&&(async()=>{try{await G.initialize(l);let{engine:e}=function(e,t){let a=document.createElement("canvas");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.pointerEvents="none",a.style.zIndex="1",e.appendChild(a);let s=e.getBoundingClientRect(),n=new Q(a,{width:s.width,height:s.height});return{canvas:a,engine:n}}(o.current);u.current=e,G.start(),e.start();let t=G.onAnalysis(t=>{h(t),e.updateAudioData(t)});return g(!0),()=>{t(),G.stop(),e.cleanup()}}catch(e){console.error("Failed to initialize enhanced sequencer:",e)}})()},[l]),(0,n.useEffect)(()=>()=>{u.current&&u.current.cleanup(),G.stop()},[]),(0,n.useEffect)(()=>{m&&o.current&&Object.entries(K(m)).forEach(e=>{let[t,a]=e;o.current.style.setProperty(t,a)})},[m]);let w=(0,n.useCallback)((e,t)=>{if(!m)return;if(u.current){let a=x.find(e=>e.id===t);if(a){let t=e/16*Math.PI*2-Math.PI/2,s=X.x+a.radius*Math.cos(t),n=X.y+a.radius*Math.sin(t);u.current.addBurst(s,n,m.energy)}}let a="step-".concat(t,"-").concat(e);Y.animate(a,1.2,V.bouncy,a=>{let s=document.querySelector('[data-step="'.concat(t,"-").concat(e,'"]'));s&&(s.style.transform="scale(".concat(a,")"))},1),setTimeout(()=>{Y.setTarget(a,1)},100)},[m,x]),j=(0,n.useCallback)((e,t)=>{y(e),k(t),v(e,t),w(t,e),r(e,t)},[y,k,v,w,r]),N=(e,n)=>{let r=e.steps[n],i=22.5*n-90,l=X.x+e.radius*Math.cos(c(i)),o=X.y+e.radius*Math.sin(c(i)),d=a===n&&t,u=f===e.id&&b===n,h=r.active?8:4,p=m?.3*m.energy:0,g=h+4*p,x=m?O("track".concat(e.name),m):e.color,y=r.active?.8+.2*p:.4,k=d?.5+p:0;return(0,s.jsxs)("g",{children:[r.active&&(0,s.jsx)("circle",{cx:l,cy:o,r:g+6,fill:"none",stroke:x,strokeWidth:"1",opacity:.3*k,className:"pointer-events-none",style:{filter:"blur(".concat(4*k,"px)")}}),(0,s.jsx)("circle",{cx:l,cy:o,r:g,fill:r.active?x:"transparent",stroke:x,strokeWidth:d?4:u?3:1,opacity:y,className:"cursor-pointer transition-all duration-200 hover:opacity-90","data-step":"".concat(e.id,"-").concat(n),onClick:()=>j(e.id,n),style:{filter:d?"drop-shadow(0 0 8px ".concat(x,")"):"none",transform:u?"scale(1.1)":"scale(1)",transformOrigin:"".concat(l,"px ").concat(o,"px")}}),r.buffer&&(0,s.jsx)("circle",{cx:l,cy:o,r:2,fill:"white",opacity:.8,className:"pointer-events-none"}),d&&(0,s.jsx)("circle",{cx:l,cy:o,r:g+3,fill:"none",stroke:"white",strokeWidth:"2",opacity:.6,className:"pointer-events-none animate-ping"})]},"".concat(e.id,"-").concat(n))},C=(e,t)=>{let a=m?O("track".concat(e.name),m):e.color,n=m&&[m.bass,m.mid,m.mid,m.treble][t]||0;return(0,s.jsxs)("g",{children:[(0,s.jsx)("circle",{cx:X.x,cy:X.y,r:e.radius,fill:"none",stroke:a,strokeWidth:2+4*n,opacity:.3+.4*n,className:"transition-all duration-300",style:{filter:n>.5?"drop-shadow(0 0 6px ".concat(a,")"):"none"}}),(0,s.jsx)("text",{x:X.x+(e.radius-25)*Math.cos(c(-90)),y:X.y+(e.radius-25)*Math.sin(c(-90))+5,textAnchor:"middle",className:"text-sm font-bold fill-current select-none",style:{fill:a,filter:n>.3?"drop-shadow(0 0 4px ".concat(a,")"):"none"},children:e.name}),e.steps.map((t,a)=>N(e,a))]},"track-".concat(e.id))};return(0,s.jsxs)("div",{ref:o,className:"relative bg-zinc-900 rounded-2xl p-8 overflow-hidden",style:{background:m?"radial-gradient(circle at center, ".concat(K(m)["--color-background-reactive"],", hsl(240, 10%, 4%))"):void 0},children:[!p&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-zinc-900/80 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-zinc-400",children:"Initializing audio visualization..."})]})}),(0,s.jsx)("div",{className:"relative w-full max-w-md mx-auto aspect-square",children:(0,s.jsxs)("svg",{viewBox:"0 0 440 440",className:"w-full h-full relative z-10",style:{filter:(null==m?void 0:m.energy)?"contrast(".concat(1+.2*m.energy,")"):"none"},children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("radialGradient",{id:"sequencer-gradient",cx:"50%",cy:"50%",r:"50%",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"rgba(16, 185, 129, 0.1)"}),(0,s.jsx)("stop",{offset:"100%",stopColor:"rgba(0, 0, 0, 0)"})]})}),(0,s.jsx)("circle",{cx:X.x,cy:X.y,r:"200",fill:"url(#sequencer-gradient)",opacity:(null==m?void 0:m.energy)||0,className:"pointer-events-none"}),x.map((e,t)=>C(e,t)),(()=>{let e=(null==m?void 0:m.energy)||0,a=t?.5+.5*e:0,n=t?"#dc2626":"#10b981";return(0,s.jsxs)("g",{className:"cursor-pointer transition-all duration-200",onClick:i,style:{transform:"scale(".concat(1+.1*e,")"),transformOrigin:"".concat(X.x,"px ").concat(X.y,"px")},children:[t&&(0,s.jsx)("circle",{cx:X.x,cy:X.y,r:35+10*e,fill:"none",stroke:n,strokeWidth:"2",opacity:.3*a,className:"pointer-events-none animate-pulse",style:{filter:"blur(".concat(8*a,"px)")}}),(0,s.jsx)("circle",{cx:X.x,cy:X.y,r:"30",fill:n,className:"transition-all duration-200 hover:opacity-90",style:{filter:"drop-shadow(0 0 ".concat(12*a,"px ").concat(t?"rgba(220, 38, 38, 0.5)":"rgba(16, 185, 129, 0.5)",")")}}),(0,s.jsx)("text",{x:X.x,y:X.y+5,textAnchor:"middle",className:"text-lg font-bold fill-white pointer-events-none select-none",children:t?"■":"▶"})]})})()]})}),m&&(0,s.jsxs)("div",{className:"absolute top-4 right-4 space-y-2 text-xs text-zinc-400",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full opacity-50",style:{opacity:m.bass}}),(0,s.jsx)("span",{children:"Bass"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-emerald-500 rounded-full opacity-50",style:{opacity:m.mid}}),(0,s.jsx)("span",{children:"Mid"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full opacity-50",style:{opacity:m.treble}}),(0,s.jsx)("span",{children:"Treble"})]})]}),m&&(0,s.jsxs)("div",{className:"absolute bottom-4 left-4 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-zinc-400",children:"Energy"}),(0,s.jsx)("div",{className:"w-16 h-1 bg-zinc-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-yellow-500 transition-all duration-100",style:{width:"".concat(100*m.energy,"%")}})})]})]})}var J=a(2650);function $(e){let{trigger:t}=e,[a,r]=(0,n.useState)(!1),i=[{key:x.PLAY_STOP,description:"Play/Stop sequencer"},{key:x.GENERATE,description:"Generate AI sample for selected step"},{key:x.CLEAR,description:"Clear selected step"},{key:x.REVERSE,description:"Toggle reverse playback"},{key:"".concat(x.BPM_DECREASE," / ").concat(x.BPM_INCREASE),description:"Adjust BPM"},{key:"1-9, 0",description:"Select steps 1-10"},{key:"Q-Y",description:"Select steps 11-16"}];return(0,s.jsxs)(J.fC,{open:a,onOpenChange:r,children:[(0,s.jsx)(J.xz,{asChild:!0,children:t||(0,s.jsx)("button",{className:"px-3 py-1 text-xs text-zinc-400 hover:text-zinc-300 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400","aria-label":"Show keyboard shortcuts",children:"?"})}),(0,s.jsxs)(J.h_,{children:[(0,s.jsx)(J.aV,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 animate-in fade-in-0"}),(0,s.jsxs)(J.VY,{className:"fixed left-1/2 top-1/2 z-50 w-full max-w-md -translate-x-1/2 -translate-y-1/2 rounded-lg bg-zinc-900 border border-zinc-700 p-6 shadow-xl animate-in fade-in-0 zoom-in-95 slide-in-from-left-1/2 slide-in-from-top-[48%]",children:[(0,s.jsx)(J.Dx,{className:"text-lg font-semibold text-zinc-100 mb-4",children:"Keyboard Shortcuts"}),(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:i.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-zinc-700 last:border-b-0",children:[(0,s.jsx)("span",{className:"text-sm text-zinc-300",children:e.description}),(0,s.jsx)("kbd",{className:"px-2 py-1 bg-zinc-800 text-zinc-200 rounded text-xs font-mono border border-zinc-600",children:e.key})]},t))}),(0,s.jsx)("div",{className:"mt-6 flex justify-end",children:(0,s.jsx)(J.x8,{asChild:!0,children:(0,s.jsx)("button",{className:"px-4 py-2 text-sm bg-zinc-700 text-zinc-300 rounded-lg hover:bg-zinc-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400",children:"Close"})})})]})]})]})}function ee(){let[e,t]=(0,n.useState)(!1),[a,i]=(0,n.useState)(120),[c,o]=(0,n.useState)(!1),[u,m]=(0,n.useState)(.9),[h,p]=(0,n.useState)(0),[g,x]=(0,n.useState)(0),b=function(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(0),r=(0,n.useRef)(0),i=v.audioLookAhead,c=v.audioScheduleAhead,l=(0,n.useCallback)(async()=>{if(!e.current)try{e.current=new(window.AudioContext||window.webkitAudioContext),"suspended"===e.current.state&&await e.current.resume(),t.current=e.current.createGain(),t.current.connect(e.current.destination),t.current.gain.value=.9}catch(e){throw console.error("Failed to initialize AudioContext:",e),e}return e.current},[]),o=(0,n.useCallback)(()=>{a.current&&(clearTimeout(a.current),a.current=null),t.current&&(t.current.disconnect(),t.current=null),e.current&&"closed"!==e.current.state&&(e.current.close(),e.current=null)},[]);return(0,n.useEffect)(()=>()=>{o()},[o]),{audioContextRef:e,masterGainRef:t,schedulerTimerRef:a,currentStepRef:s,nextNoteTimeRef:r,initAudioContext:l,cleanup:o,lookAhead:i,scheduleAheadTime:c}}(),{tracks:k,library:T,genQueue:z,selectedTrack:S,selectedStep:M,updateStep:R,toggleStep:E,toggleStepMulti:P,addToLibrary:B,assignToStep:G,assignToStepMulti:L,addToQueue:q,updateQueueItem:U,audioCache:_,clearStep:H,clearStepMulti:O,setSelectedTrack:K,setSelectedStep:Q,setTrackVolume:V,setTrackMute:W,setTrackSolo:Y,clearTrack:X,setLoading:J,setError:ee,clearError:et}=d(),ea=(0,n.useMemo)(()=>{var e;if(S){let e=k.find(e=>e.id===S);return(null==e?void 0:e.steps)||[]}return(null===(e=k[0])||void 0===e?void 0:e.steps)||[]},[k,S]),es=(0,n.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(b.audioContextRef.current&&b.masterGainRef.current)try{let s=b.audioContextRef.current.createBufferSource(),n=b.audioContextRef.current.createGain();s.buffer=c?en(e):e,s.connect(n),n.connect(b.masterGainRef.current),n.gain.value=a,s.start(t),s.onended=()=>{try{n.disconnect(),s.disconnect()}catch(e){}},setTimeout(()=>{try{s.stop()}catch(e){}},v.maxPreviewDuration)}catch(e){console.error("Failed to schedule note:",e)}},[b.audioContextRef,b.masterGainRef,c]),en=(0,n.useCallback)(e=>{if(!b.audioContextRef.current)return e;let t=b.audioContextRef.current.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let a=0;a<e.numberOfChannels;a++){let s=e.getChannelData(a),n=t.getChannelData(a);for(let e=0;e<s.length;e++)n[e]=s[s.length-1-e]}return t},[b.audioContextRef]),er=(0,n.useCallback)(()=>{if(!b.audioContextRef.current)return;let e=b.audioContextRef.current.currentTime;for(;b.nextNoteTimeRef.current<e+b.scheduleAheadTime;){let e=b.currentStepRef.current;k.forEach(t=>{if(t.muted||k.some(e=>e.solo)&&!t.solo)return;let a=t.steps[e];if(a.active&&a.buffer&&Math.random()<a.prob){let s=e%2==1?.1*h:0;es(a.buffer,b.nextNoteTimeRef.current+s,a.gain*t.volume)}});let t=60/a/4;b.nextNoteTimeRef.current+=t,b.currentStepRef.current=(b.currentStepRef.current+1)%16,x(b.currentStepRef.current)}b.schedulerTimerRef.current=window.setTimeout(er,b.lookAhead)},[b,k,es,a,h]),ei=(0,n.useCallback)(async()=>{try{if(console.log("startPlayback called"),await b.initAudioContext(),!b.audioContextRef.current)throw Error("Failed to initialize audio context");console.log("Audio context initialized, starting scheduler"),b.nextNoteTimeRef.current=b.audioContextRef.current.currentTime,er(),console.log("Scheduler started")}catch(e){console.error("startPlayback error:",e),console.log("Audio failed but keeping UI in playing state")}},[b,er,ee]),ec=(0,n.useCallback)(()=>{console.log("stopPlayback called - this will set isPlaying to false"),b.schedulerTimerRef.current&&(clearTimeout(b.schedulerTimerRef.current),b.schedulerTimerRef.current=null),t(!1),console.log("stopPlayback called setIsPlaying(false)"),b.currentStepRef.current=0,x(0)},[b]),el=(0,n.useCallback)(async()=>{console.log("togglePlayback called, isPlaying:",e),e?(console.log("Calling stopPlayback"),ec()):(console.log("Calling startPlayback"),console.log("About to call setIsPlaying(true) in togglePlayback"),t(!0),console.log("Called setIsPlaying(true) in togglePlayback"),await ei())},[e,ei,ec]);(0,n.useEffect)(()=>{b.masterGainRef.current&&(b.masterGainRef.current.gain.value=u)},[u,b.masterGainRef]);let eo=(0,n.useCallback)(async e=>{b.audioContextRef.current||await b.initAudioContext();let t=b.audioContextRef.current;for(let a of e)try{J(!0,"Processing ".concat(a.name,"..."));let e=await a.arrayBuffer(),s=await t.decodeAudioData(e),n={id:l(),name:a.name.replace(/\.[^/.]+$/,""),buffer:s,duration:s.duration,type:"local"};B(n)}catch(e){ee("Failed to process ".concat(a.name,": ").concat(e instanceof Error?e.message:"Unknown error"))}J(!1)},[b,B,J,ee]),ed=(0,n.useCallback)(async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e){for(var t=arguments.length,a=Array(t>1?t-1:0),s=1;s<t;s++)a[s-1]=arguments[s];v.debugGeneration&&console.log("[GENERATION DEBUG] ".concat(e),...a)}("Starting generation",{prompt:e,stepIdx:t,options:a});try{let s;b.audioContextRef.current||await b.initAudioContext();let n=l();if(q({id:n,prompt:e,status:"generating",progress:0,trackId:S||void 0}),J(!0,"Generating audio..."),v.isStaticMode)s=await I(e);else{let t=w(),n=(await r.Z.post("".concat(t,"/generate"),{prompt:e,quality:"high"===a.quality?"high":"draft",duration:8,cfg_coef:7.5})).data.audio,i=await b.audioContextRef.current.decodeAudioData(Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer);s={id:l(),name:"AI: ".concat(e.slice(0,20)).concat(e.length>20?"...":""),buffer:i,duration:i.duration,type:"ai",prompt:e}}B(s),U(n,{status:"ready"}),void 0!==t&&S&&L(S,t,s.id)}catch(s){let t=s instanceof Error?s.message:"Generation failed";ee("AI generation failed: ".concat(t));let a=z.find(t=>t.prompt===e&&"generating"===t.status);a&&U(a.id,{status:"error"})}finally{J(!1)}},[b,q,B,L,S,U,z,J,ee]),eu=(0,n.useCallback)(()=>{S&&null!==M&&ed("Generated sample for track ".concat(S," step ").concat(M+1),M)},[S,M,ed]),em=(0,n.useCallback)(()=>{S&&null!==M&&O(S,M)},[S,M,O]);return!function(e){let t=(0,n.useCallback)(t=>{var a;if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement||(null===(a=t.target)||void 0===a?void 0:a.contentEditable)==="true")return;let s=t.code,n=t.key.toUpperCase();switch(s){case"Space":t.preventDefault(),e.onPlayStop();break;case"KeyG":t.preventDefault(),e.onGenerate();break;case"KeyC":t.preventDefault(),e.onClear();break;case"KeyR":t.shiftKey||(t.preventDefault(),e.onReverse());break;case"ArrowRight":t.preventDefault(),e.onBpmAdjust("increase");break;case"ArrowLeft":t.preventDefault(),e.onBpmAdjust("decrease")}if(f.includes(n)){t.preventDefault();let a=f.indexOf(n);e.onStepSelect(a)}},[e]);(0,n.useEffect)(()=>(document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}),[t])}({onPlayStop:el,onGenerate:eu,onClear:em,onReverse:(0,n.useCallback)(()=>{o(e=>!e)},[]),onStepSelect:(0,n.useCallback)(e=>{Q(e)},[Q]),onBpmAdjust:(0,n.useCallback)(e=>{i(t=>Math.max(40,Math.min(200,t+("increase"===e?5:-5))))},[])}),(0,n.useEffect)(()=>()=>{b.schedulerTimerRef.current&&(clearTimeout(b.schedulerTimerRef.current),b.schedulerTimerRef.current=null),t(!1),b.currentStepRef.current=0,x(0),b.cleanup()},[]),(0,s.jsxs)("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-8 space-y-6",children:[(0,s.jsxs)("header",{className:"text-center mb-8 relative",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-6xl font-bold bg-gradient-to-r from-emerald-400 to-purple-500 bg-clip-text text-transparent mb-2",children:"ORBITR"}),(0,s.jsx)("p",{className:"text-zinc-400",children:"Multi-track circular sequencer with AI sample generation"}),(0,s.jsx)("div",{className:"absolute top-0 right-0",children:(0,s.jsx)($,{})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsx)(Z,{isPlaying:e,currentStep:g,onStepClick:(e,t)=>{K(e),Q(t)},onPlayheadClick:el,audioContext:b.audioContextRef.current||void 0}),(0,s.jsx)(C,{isPlaying:e,onPlayStop:el,bpm:a,onBpmChange:i,reverse:c,onReverseChange:o,swing:h,onSwingChange:p,masterGain:u,onMasterGainChange:m})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(A,{tracks:k,selectedTrack:S,onSelectTrack:K,onVolumeChange:V,onMuteToggle:e=>{let t=k.find(t=>t.id===e);t&&W(e,!t.muted)},onSoloToggle:e=>{let t=k.find(t=>t.id===e);t&&Y(e,!t.solo)},onClearTrack:X}),(0,s.jsx)(D,{onPackLoad:e=>{console.log("Loaded sample pack: ".concat(e))}}),(0,s.jsx)(y,{steps:ea,onStepChange:R,onAssign:G,onGenerate:ed,onClear:e=>{S&&O(S,e)},library:T})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(j,{library:T,onFileUpload:eo}),(0,s.jsx)(N,{queue:z})]}),(0,s.jsx)(F,{})]})}function et(){return(0,s.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-zinc-950 to-zinc-900 p-4",children:(0,s.jsx)(ee,{})})}}},function(e){e.O(0,[87,971,117,744],function(){return e(e.s=8728)}),_N_E=e.O()}]);